# 多策略框架使用指南

**版本**: v5.0.0  
**完成时间**: 2026-02-27 21:30

---

## 🎯 框架概述

多策略框架根据**市场状态**和**股票特性**自动选择最佳策略，解决单一策略鲁棒性不足的问题。

### 核心优势

| 维度 | 单一策略 | 多策略框架 |
|------|----------|------------|
| 适用股票 | 仅 GOOGL | GOOGL/META/AMD/NFLX 等 |
| 市场适应 | 仅牛市 | 牛市/熊市/震荡市 |
| 鲁棒性 | ⭐⭐ (2/5) | ⭐⭐⭐⭐ (4/5) |
| 回测达标率 | 10% (1/10) | 预期 60%+ |

---

## 📊 四大策略

### 1️⃣ 趋势跟踪策略 (Trend Following)

**适用**: GOOGL 类单边上涨股票  
**市场状态**: BULL_MARK

**核心逻辑**:
```python
买入条件:
- SMA50 > SMA200 且 价格 > SMA50 (严格趋势过滤)
- RSI 30-60 (适中)
- MACD 金叉

卖出条件:
- SMA50 < SMA200 (趋势反转)
- 价格跌破 SMA50
- RSI > 70 (超买)
```

**特点**:
- ✅ 严格趋势过滤，避免逆势交易
- ✅ 抓住大趋势，让利润奔跑
- ❌ 震荡市中频繁止损

---

### 2️⃣ 均值回归策略 (Mean Reversion)

**适用**: META/AMZN 类震荡股票  
**市场状态**: RANGING

**核心逻辑**:
```python
买入条件:
- RSI < 30 (超卖)
- 随机指标超卖金叉
- 价格触及布林带下轨

卖出条件:
- RSI > 70 (超买)
- 随机指标超买死叉
- 价格触及布林带上轨
```

**特点**:
- ✅ 震荡市低买高卖
- ✅ 高胜率
- ❌ 单边趋势中踏空/套牢

---

### 3️⃣ 突破策略 (Breakout)

**适用**: AMD/NVDA/INTC 类高波动股票  
**市场状态**: VOLATILE_BULL

**核心逻辑**:
```python
买入条件:
- 突破关键阻力位
- 成交量放大 1.5 倍确认
- 创 52 周新高

卖出条件:
- 跌破支撑位
- 假突破 (突破后快速回落)
```

**特点**:
- ✅ 抓住爆发性行情
- ✅ 成交量确认，减少假信号
- ❌ 高波动，止损频繁

---

### 4️⃣ 防守策略 (Defensive)

**适用**: NFLX/MSFT 类下跌趋势股票  
**市场状态**: BEAR_MARK

**核心逻辑**:
```python
买入条件:
- RSI < 25 (极度超卖，短线反弹)

卖出条件:
- 反弹到 SMA20 (获利了结)
- RSI > 50 (退出)
- 趋势继续向下 (空仓观望)

默认：HOLD (空仓观望)
```

**特点**:
- ✅ 下跌趋势中保护本金
- ✅ 只参与强力反弹
- ❌ 牛市踏空

---

## 🔄 策略选择矩阵

| 市场状态 \ 股票类型 | TRENDING (趋势型) | RANGING (震荡型) | VOLATILE (高波动) | DECLINING (下跌型) |
|---------------------|-------------------|------------------|-------------------|-------------------|
| **BULL_MARK** (牛市) | 趋势跟踪 ⭐⭐⭐⭐⭐ | 趋势跟踪 ⭐⭐⭐⭐ | 突破 ⭐⭐⭐⭐⭐ | 趋势跟踪 ⭐⭐⭐ |
| **RANGING** (震荡) | 趋势跟踪 ⭐⭐⭐ | 均值回归 ⭐⭐⭐⭐⭐ | 突破 ⭐⭐⭐ | 防守 ⭐⭐ |
| **VOLATILE_BULL** (高波上涨) | 突破 ⭐⭐⭐⭐ | 均值回归 ⭐⭐⭐ | 突破 ⭐⭐⭐⭐⭐ | 防守 ⭐⭐ |
| **BEAR_MARK** (熊市) | 防守 ⭐⭐⭐ | 防守 ⭐⭐⭐⭐ | 防守 ⭐⭐ | 防守 ⭐⭐⭐⭐⭐ |

---

## 🚀 使用方法

### 方式 1: 直接使用

```python
from strategies.multi_strategy_framework import MultiStrategyCoordinator

coordinator = MultiStrategyCoordinator()

result = coordinator.execute(
    symbol='GOOGL',
    row=data_row,
    indicators={
        'current_price': 175.0,
        'sma_50': 165.0,
        'sma_200': 155.0,
        'rsi_14': 45.0,
        ...
    }
)

print(f"决策：{result['action']}")
print(f"策略：{result['strategy_used']}")
print(f"置信度：{result['confidence']:.1%}")
```

### 方式 2: 命令行

```bash
# 待实现
python3 main.py backtest GOOGL --start 2025-06-01 --strategy multi
```

---

## 📈 测试案例

### GOOGL - 趋势型股票

```
市场状态：BULL_MARK
股票类型：TRENDING
使用策略：trend_following
决策：BUY
置信度：80%
理由：牛市上涨趋势 + 趋势型股票 → 使用趋势跟踪策略
```

### META - 震荡型股票

```
市场状态：RANGING
股票类型：RANGING
使用策略：mean_reversion
决策：HOLD
置信度：80%
理由：震荡市 + 震荡型股票 → 使用均值回归策略
```

### AMD - 高波动股票

```
市场状态：VOLATILE_BULL
股票类型：VOLATILE
使用策略：breakout
决策：BUY
置信度：80%
理由：高波动上涨 + 高波动股票 → 使用突破策略
```

### NFLX - 下跌趋势股票

```
市场状态：BEAR_MARK
股票类型：DECLINING
使用策略：defensive
决策：SELL
置信度：60%
理由：熊市下跌趋势 + 下跌趋势股票 → 使用防守策略
```

---

## 🎯 预期改进

### 回测表现对比

| 指标 | 单一策略 | 多策略框架 | 改进 |
|------|----------|------------|------|
| 达标股票数 | 1/10 (10%) | 预期 6/10 (60%) | ⬆️ +500% |
| 平均收益 | +15.68% | 预期 +35% | ⬆️ +123% |
| 平均回撤 | -22% | 预期 -12% | ⬇️ -45% |
| 平均夏普 | 0.45 | 预期 1.5 | ⬆️ +233% |

### 各股票预期表现

| 股票 | 单一策略收益 | 多策略预期收益 | 使用策略 |
|------|-------------|---------------|----------|
| GOOGL | +63.92% | +65% | 趋势跟踪 |
| INTC | +79.21% | +75% | 突破策略 |
| AMD | +62.63% | +60% | 突破策略 |
| AAPL | +12.50% | +35% | 趋势跟踪 |
| NVDA | +9.53% | +45% | 突破策略 |
| META | -6.55% | +25% | 均值回归 |
| AMZN | -4.93% | +20% | 均值回归 |
| MSFT | -15.99% | +15% | 趋势跟踪 |
| TSLA | -7.04% | +30% | 突破策略 |
| NFLX | -36.76% | -5% | 防守策略 |

---

## 📁 文件结构

```
strategies/
├── multi_strategy_framework.py  # 多策略框架核心
│   ├── trend_following_strategy()    # 趋势跟踪
│   ├── mean_reversion_strategy()     # 均值回归
│   ├── breakout_strategy()           # 突破
│   ├── defensive_strategy()          # 防守
│   ├── identify_market_regime()      # 市场状态识别
│   ├── classify_stock_characteristics()  # 股票分类
│   └── MultiStrategyCoordinator      # 协调器
│
├── optimized_v2_strategy.py       # 原优化策略 V2
└── relaxed_strategy.py            # 原宽松策略
```

---

## 🔧 下一步

### 高优先级 (本周)

1. **集成到 main.py**
   ```bash
   python3 main.py backtest GOOGL --strategy multi
   ```

2. **大规模回测验证**
   - 测试 10 只股票
   - 对比单一策略 vs 多策略

3. **LLM 分析师集成**
   - 使用真实 LLM 进行市场状态判断
   - LLM 评估股票特性

### 中优先级 (下周)

4. **参数优化**
   - 各策略参数网格搜索
   - 不同股票专属参数

5. **动态策略切换**
   - 根据市场变化自动调整
   - 过渡期平滑处理

---

## 💡 关键洞察

### 为什么多策略有效？

1. **市场状态识别** - 不同市场用不同策略
2. **股票特性分类** - 不同股票用不同方法
3. **风险分散** - 不依赖单一策略
4. **适应性增强** - 市场变化时自动切换

### 成功关键

- ✅ 准确识别市场状态
- ✅ 正确分类股票特性
- ✅ 策略切换时机把握
- ✅ 各策略参数优化

---

**文档版本**: v1.0  
**创建时间**: 2026-02-27 21:30  
**维护**: 量化交易公司策略部
